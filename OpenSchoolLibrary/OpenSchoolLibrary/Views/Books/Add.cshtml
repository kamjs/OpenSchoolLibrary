<title>"Add a Book"</title>

<h2>Add a Book</h2>
<hr />

<form class="isbncheck" action="/isbn/check" method="post" >
    @Html.AntiForgeryToken()
    <div class="form-horizontal">

        <div class="form-group">
            <div class="control-label col-md-2">
                <label>ISBN:</label>
            </div>
            <div class="col-md-10">
                <input type="text" name="ISBN" pattern="[0-9]{9}[0-9X]" placeholder="Only one is required." onkeyup="DisableISBN13()" class="form-control">
                <div class="ISBNError text-danger"></div>
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-2">
                <label>ISBN 13:</label>
            </div>
            <div class="col-md-10">
                <input type="text" name="ISBN13" pattern="97[89][0-9]{10}" placeholder="Only one is required." onkeyup="DisableISBN()" class="form-control">
                <div class="ISBN13Error text-danger"></div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Check" class="btn btn-default" />
            </div>
        </div>

    </div>
</form>

<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

<script type="text/javascript">

    document.addEventListener("DOMContentLoaded", function (event) {
        console.log("DOM fully loaded and parsed");

        document.querySelector('.isbncheck').addEventListener('submit', (ev) => {
        console.log("isbn entry");
        var isbn = document.querySelector("input[name=ISBN]");
        var isbn13 = document.querySelector("input[name=ISBN13]");
        var isbnPattern = new RegExp("[0-9]{9}[0-9X]");
        var isbn13Pattern = new RegExp("97[89][0-9]{10}");

        document.querySelector('.ISBNError').textContent = "";
        document.querySelector('.ISBN13Error').textContent = "";

        if (!isbn.value.length == 0) {
            if (!isbnPattern.test(isbn.value)) {
                document.querySelector('.ISBNError').textContent = "ISBN not valid. Use numbers only or X at the end.";
                isbn.focus();

                console.log("ISBN Pattern Fail");
                ev.preventDefault();
            }
        }

        if (!isbn13.value.length == 0) {
            if (!isbn13Pattern.test(isbn13.value)) {
                document.querySelector('.ISBN13Error').textContent = "ISBN 13 not valid. Use numbers only.";
                isbn13.focus();

                console.log("ISBN 13 Pattern Fail");
                ev.preventDefault();
            }
        }

        if (isbn.value.length == 0 && isbn13.value.length == 0) {
            document.querySelector('.ISBNError').textContent = "Both fields cannot be Blank.";
            document.querySelector('.ISBN13Error').textContent = "Both fields cannot be Blank.";

            console.log("ISBN & ISBN13 are Blank.");
            isbn.focus();
            ev.preventDefault();
        }

        });

    });

    function DisableISBN() {
        document.querySelector("input[name=ISBN]").disabled = true;
    }

    function DisableISBN13() {
        document.querySelector("input[name=ISBN13]").disabled = true;
    }

</script>